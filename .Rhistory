get_headcount <- function(.data, date_val){
date_val <- as.Date(date_val)
.data %>%
mutate(status = case_when(hire_date <= {{ date_val }} ~ 1,
TRUE ~ NA_real_),
status = case_when(termination_date > {{ date_val }} |
is.na(termination_date) ~ status,
termination_date < {{ date_val }} ~ 0)) %>%
# group_by(status, .add=TRUE) %>%
# count() %>%
# filter(status == "active") %>%
# ungroup() %>%
# select(- status)
summarize(headcount = sum(status, na.rm=TRUE))
# "0" = Terminated PRIOR to the supplied date.
# "1" = Active as of the supplied date.
# NA = Either no term date, Term date ON the supplied date, or a term date in the future.
}
library(devtools)
use_r("get_headcount")
load_all()
load_all()
load_all()
check()
check()
use_mit_license()
library(readr)
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
View(WF_Assessment_Data)
library(tidyverse)
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
View(WF_Assessment_Data)
View(WF_Assessment_Data)
WFM_tms_play <- WF_Assessment_Data
save(WFM_tms_play, file = "data/WFM_tms_play.Rda")
names(WFM_tms_play)
WFM_tms_play <-WFM_tms_play %>%
janitor::clean_names()
names(WFM_tms_play)
load_all()
document()
load_all()
library(TIAHelpers)
load_all()
document()
TIAHelpers::WFM_tms_play
load_all()
document()
load_all()
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
WFM_tms_play <- WF_Assessment_Data
wfm_tms_play <-WFM_tms_play %>%
janitor::clean_names()
save(WFM_tms_play, file = "data/wfm_tms_play.Rda")
names(wfm_tms_play)
load_all()
document()
usethis::use_data(wfm_tms_play)
usethis::use_data(wfm_tms_play, overwrite = TRUE)
document()
load_all()
wfm_tms_play %>%
get_headcount("2022-01-01")
wfm_tms_play
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date == lubridate::ymd(hire_date))
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date == lubridate::mdY(hire_date))
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date == lubridate::mdy(hire_date))
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date = lubridate::mdy(hire_date))
View(wfm_tms_play)
wfm_tms_play <-WFM_tms_play %>%
janitor::clean_names()
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date = lubridate::mdy(hire_date)) %>%
mutate(termination_date = lubridate::mdy(termination_date))
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
WFM_tms_play <- WF_Assessment_Data
wfm_tms_play <-WFM_tms_play %>%
janitor::clean_names()
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date = lubridate::mdy(hire_date)) %>%
mutate(termination_date = lubridate::mdy(termination_date))
usethis::use_data(wfm_tms_play, overwrite = TRUE)
document()
load_all()
wfm_tms_play %>%
get_headcount("2022-01-01")
wfm_tms_play %>%
group_by(region) %>%
get_headcount("2022-01-01")
document()
use_package("tidyverse")
use_package("dplyr")
document()
load_all()
library(TIAHelpers)
wfm_tms_play %>%
group_by(region) %>%
get_headcount("2022-01-01")
usethis::use_pipe()
library(devtools)
document()
use_package("dplyr")
document()
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
library(readr)
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
library(tidyverse)
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
WFM_tms_play <- WF_Assessment_Data
wfm_tms_play <-WFM_tms_play %>%
janitor::clean_names()
usethis::use_data(wfm_tms_play, overwrite = TRUE)
document()
wfm_tms_play
WF_Assessment_Data <- read_csv("C:/Users/2371328/Downloads/WF_Assessment_Data.csv")
WF_Assessment_Data <- WF_Assessment_Data %>%
select(-...12, -...13)
WFM_tms_play <- WF_Assessment_Data
wfm_tms_play <-WFM_tms_play %>%
janitor::clean_names()
wfm_tms_play <- wfm_tms_play %>%
mutate(hire_date = lubridate::mdy(hire_date)) %>%
mutate(termination_date = lubridate::mdy(termination_date))
usethis::use_data(wfm_tms_play, overwrite = TRUE)
document()
document()
library(TIAHelpers)
library(TIAHelpers)
library(TIAHelpers)
#' Get Headcount Average
#'
#' @param .data Existing data. Not required if piping (`%>%`) using the tidyverse workflow.
#' @param d1 Date for the time that headcount should be calculated. Date should be in ymd format. It is recommended that all date field are correctly declared using lubridate::ymd().
#' @param month_offset Number of *months* to offset the original date. This is set to 3 months by default (the span of 1 quarter.)
#'
#' @return Tibble containing headcounts at two dates plus the average headcount.
#' @export
#'
#' @examples
get_headcount_avg <- function(.data, d1, month_offset = 3){
d1 <- as.Date(d1)
d2 <- max(d1, d1 + months(month_offset) - 1)
.data %>%
get_headcount(d1) %>%
rename(headcount_date_1 = headcount) -> s1
.data %>%
get_headcount(d2)  %>%
rename(headcount_date_2 = headcount) -> s2
if(length(s1) == 1){
tibble(s1, s2) %>%
rowwise() %>%
mutate(average = num(mean(c(headcount_date_1, headcount_date_2), na.rm=TRUE),
digits=3)) %>% # added 3 digit option
ungroup()
} else {
suppressMessages(
s1 %>%
left_join(s2) %>%
rowwise() %>%
mutate(average = num(mean(c(headcount_date_1, headcount_date_2), na.rm=TRUE),
digits=3)) %>% # added 3 digit option
ungroup()
)
}
}
wfm_tms_play %>%
group_by(region) %>%
get_headcount_avg("2022-01-01")
wfm_tms_play %>%
get_headcount_avg("2022-01-01")
document()
use_package("lubridate")
document()
load_all()
document()
document()
load_all()
library(TIAHelpers)
document()
